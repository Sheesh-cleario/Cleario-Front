<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manager</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
          integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<body>

<!--manager header-->
<header class="header">
    <div class="container">

        <div class="manager-header-container">
            <div class="name-header">
                <span>Cleaning Up Service</span>
            </div>
            <div class="name-header-manager">
                <span>for managers</span>
            </div>
        </div>

        <div class="user">
            <img src="images/Manager.png" alt="">
            <div class="name">Alina Litoshka</div>
        </div>
    </div>
</header>
<!--manager header-->

<!--manager content-->
<div>

    <div class="navigation">
        <div class="menu-toggle"></div>
        <ul>
            <li>
                <a href="#">
                    <div class="history-of-orders"><img src="images/Basket.png" alt=""></div>
                    <span class="text-history-of-orders">История заказов</span>
                </a>
            </li>
        </ul>
    </div>

    <script>
        const menuToggle = document.querySelector('.menu-toggle')
        const navigation = document.querySelector('.navigation')
        menuToggle.onclick = function () {
            navigation.classList.toggle('open')
        }
    </script>

    <span class="name-orders">Заказы</span>

    <div class="all-orders manager-all-orders">

        <ul id="allOrders">
        </ul>

    </div>

    <script>
        const draggable_list = document.getElementById('allOrders');
        var index = 0;

        let url = 'https://localhost:7073/api/Order/all';
        const allOrdersRequest = new XMLHttpRequest();
        allOrdersRequest.open("GET", url, true);
        allOrdersRequest.onload = function () {
            //const allOrders = JSON.parse(allOrdersRequest.responseText);
            //localStorage.setItem('allOrders', JSON.parse(allOrdersRequest.responseText));
            localStorage.setItem('allOrders', JSON.stringify(JSON.parse(allOrdersRequest.responseText)));
        }
        allOrdersRequest.send(null);
        Load();

        function Load() {
            const allOrders = JSON.parse(localStorage.getItem("allOrders"));
            console.log(allOrders);
            for(let i = index; i < allOrders.length; i++){
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                <a style="text-decoration: none" href="managerOrderFormation.html">
                    <div class="order manager-order">
                        <div>
                            <div class="order-number">
                                <span>${allOrders[i]['orderName']}, ${allOrders[i]['orderLocation']}</span>
                            </div>
                            <div class="order-date">
                                <span>${allOrders[i]['orderStart']}</span>
                            </div>
                        </div>
                        <div class="order-status">
                            <button class="button manager-button">
                                <i class="fa fa-exclamation-circle fa-3x" aria-hidden="true"></i>
                                <span class="manager-button-text">Ожидание начала</span>
                            </button>
                        </div>

                    </div>
                </a>
                `;

                draggable_list.appendChild(listItem);
                index = allOrders.length;
            }
        }

        setInterval(Load, 5000);
    </script>

    <div style="text-align: center">
        <button class="order-button" id="order-button" style="margin-top: 80px">
            <div class="order-button-text">Сформировать заказ</div>
        </button>
    </div>

    <script>
        document.getElementById('order-button').onclick = function() {
            window.location.href = 'managerOrderFormation.html';
        };
    </script>
</div>
<!--manager content-->

</body>
</html>